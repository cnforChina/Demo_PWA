# 以Jpsi->Gamma KK为例

## 快速上手
完成了环境设置之后，可以尝试第一个例子。
分波分析之所以比较难，除了物理问题复杂的原因外，在程序实现方面也比较复杂和耗时。在深入往下尝试的之前我建议先看看分波分析的大致流程，从事例挑选，本底扣除，likelihood的构造，最佳解的寻找，显著性的计算。在了解这些基本知识之后你就可以看懂下面程序是在做什么。如果你想做一个新的物理过程的分波分析，那么了解这些还是不够的，你还需要了解如何利用GPUPWA的框架写出协变张量的振幅。这个需要结合[邹斌松老师的文章](http://link.springer.com/10.1140/epja/i2002-10135-4)和GPUPWA下振幅构造的规则进行学习。

### 本目录下：

### 主程序：GammaKK.cpp
  1. 程序负责data和mc的数据读入
  2. 分波振幅的构造
  3. 拟合方法的选择
  4. 作图（非必要）
### 输入文件：

configuration文件： files.txt 

里面指定数据文件，共振态的参数文件：

数据文件： data目录 data.root  phsp.root

共振态参数文件： res.inp ，包含共振态的质量宽度，中心值，步长（步长为负数代表此参数固定），取值范围

分波振幅参数文件：para.inp， 包含各个分波振幅的振幅相角参数，同样包含中心值，步长（步长为负数代表此参数固定），取值范围

输出：

mc积分文件GammaKKAnalyiss_Amplitude_MC_Integral，拟合likelihood值，拟合参数结果。
含有拟合图的ps文件以及各个成分以及干涉的root文件。

## 几个问题？
1. root文件是如何读入的？ 是否有格式要求？
2. 分波振幅应该怎么写？ 怎么构造框架有利于快速的增减分波个数？
3. 分波振幅和参数文件之间是什么关系？他们是怎么联系起来的？
4. MC积分文件是什么意思，有什么作用？

答：

1. root的读入由类GPUStreamInputRootFileVector来实现，具体代码可见GPUPWA下的GPUPWA/GPUStreamInputRootFileVector.cpp. 遵循ROOT的语法。
root的输入需要float型变量，事例为4的整数倍（与gpu的处理有关）。

2. 分波振幅的构造方法需要单独写，这里只写在已知振幅的构造方法的前提下如何写出对应过程的代码。以gamma KK为例。 我们知道 jpsi->gamma X -> gamma KK
其中X的jpc只能为0++，2++， 偶数++。忽略高角动量下的贡献，对于X->KK的分波形式是有限的。比如我们只考虑到2++。那么我们只需要写出jpsi->gamma 0++ -> gamma KK 和 jpai-> gamma 2++ KK 的分波即可。那么是不是在程序里面我只需要写两个分波就可以了呢？事实上，你只需要写两种分波。但是每种分波里面有哪些成分你是不知道的（如果你知道了就不需要做分波了）。目前GammaKK中的写法是你需要增加哪些0++和2++的共振态就在主程序中添加（这个是极其不方便的，如果你有大量的候选成分，每次增加或者减少成分都需要重新修改程序，重新编译。此情况会在后面的例子中改进）。所以在这里你可以思考如何构建框架，使得快速的增减分波个数。

3. 分波振幅的构造都是由类来实现，通过参数传递的方式与参数文件交互。在GammaKK的例子当中，振幅部分的参数由类中共振态的名字和该振幅的名字作为识别的参数。

4. MC积分文件存储的是事例求和后的FUN_ij值。i，j代表分波。表示的是第i和第j个分波的除了传播子部分的模方值。利用FUN_ij可以结合拟合结果中每个分波的振幅相角直接计算fraction和干涉。
